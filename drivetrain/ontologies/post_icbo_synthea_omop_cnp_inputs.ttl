# baseURI: https://unnamed/acorn/inputs
# prefix: inputs

@prefix : <https://unnamed/acorn/post_icbo_synthea_omop_cnp_inputs/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ontologies: <http://transformunify.org/ontologies/> .
@prefix turbo: <http://transformunify.org/ontologies/> .
@prefix obo: <http://purl.obolibrary.org/obo/> .

<http://api.stardog.com/visit_occurrence> a owl:Class .
<http://api.stardog.com/person> a owl:Class .
<http://api.stardog.com/procedure_occurrence> a owl:Class .
ontologies:syntheaomop_post_icbo a owl:Class .
ontologies:cdm_synthea10 a owl:Class .
ontologies:procedure_occurrence a owl:Class .
ontologies:procedure_source_value a owl:Class .

ontologies:post_icbo_synthea_omop_cnp_patients
  a ontologies:TURBO_0010178 ;
  ontologies:hasOutput ontologies:GidAboutPatient ; 
  ontologies:hasOutput ontologies:cridDenotesPatient;
  ontologies:hasOutput ontologies:dobAboutSns ;
  ontologies:hasOutput ontologies:dobHasMeasVal ;
  ontologies:hasOutput ontologies:gidTypingRecipe ;
  ontologies:hasOutput ontologies:hardcodedPatientRegden ;
  ontologies:hasOutput ontologies:patCridsymbHasRepresentation ;
  ontologies:hasOutput ontologies:patientBornOnSns ;
  ontologies:hasOutput ontologies:patientExpansionSpecification ;
  ontologies:hasOutput ontologies:symbolPartOfCridForPatient ;
  ontologies:hasRequiredInput ontologies:miniPatientCridsymShortcut ;
  ontologies:hasRequiredInput ontologies:patientDobShortcut ;
  ontologies:hasRequiredInput ontologies:patientGidShortcut ;
  ontologies:inputNamedGraph ontologies:omopShortcuts ;
  ontologies:outputNamedGraph ontologies:omopExpanded ;
  ontologies:precedes ontologies:post_icbo_synthea_omop_cnp_encounters ;
  # ontologies:hasRequiredInput ontologies:ontologies:GidHasOmopCode ;
.
ontologies:miniPatientCridsymShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ## ontologies:required true ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/person> ;
  ontologies:predicate <http://api.stardog.com/person#person_source_value> ;
  ontologies:object ontologies:person_source_value_StringLiteralValue ;
.

ontologies:patientDobShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/person> ;
  ontologies:predicate <http://api.stardog.com/person#birth_datetime> ;
  ontologies:object ontologies:birth_datetime_DateLiteralValue ;
.

ontologies:patientGidShortcut
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:required true ;
  ontologies:subject <http://api.stardog.com/person> ;
  ontologies:predicate <http://api.stardog.com/person#gender_concept_id> ;
  ontologies:object ontologies:gender_concept_id_StringLiteralValue ;
  ontologies:objectRequiredToCreate ontologies:GidClassList ;
.

ontologies:GidClassList ontologies:usesCustomVariableManipulationRule ontologies:gidClassFromValueRule .

ontologies:gidClassFromValueRule
  a ontologies:TurboGraphVariableManipulationLogic ;
  ontologies:usesSparql """
  BIND(IF (${dependent} = 8532, obo:OMRSE_00000138, ?unbound) AS ?femGidClass) 
  BIND(IF (${dependent} = 8507, obo:OMRSE_00000141, ?unbound) AS ?maleGidClass) 
  bind(coalesce(?femGidClass, ?maleGidClass, obo:OMRSE_00000133) as ${replacement})
"""  ;
.

### encounters


# _ is wildcard 
ontologies:post_icbo_synthea_omop_cnp_encounters
  a ontologies:TURBO_0010178 ;
  ontologies:hasOutput ontologies:cridDenotesHce ;
  ontologies:hasOutput ontologies:encCridsymbHasRepresentation ;
  ontologies:hasOutput ontologies:encounterTypingRecipe ;
  ontologies:hasOutput ontologies:endingTmdAboutProcbound ;
  ontologies:hasOutput ontologies:endingTmdHasMeasVal ;
  ontologies:hasOutput ontologies:hardcodedRegden_octtr ;
  ontologies:hasOutput ontologies:hceExpansionSpecification ;
  ontologies:hasOutput ontologies:procboundEndsEnc ;
  ontologies:hasOutput ontologies:procboundStartsEnc ;
  ontologies:hasOutput ontologies:startingTmdAboutProcbound ;
  ontologies:hasOutput ontologies:startingTmdHasMeasVal ;
  ontologies:hasOutput ontologies:symbolPartOfCridForHce ;
  ontologies:hasRequiredInput ontologies:miniHceCridsymShortcut ;
  ontologies:hasRequiredInput ontologies:miniHceEnddateShortcut ;
  ontologies:hasRequiredInput ontologies:miniHceStartdateShortcut ;
  ontologies:hasRequiredInput ontologies:miniHceTypeShortcut ;
  ontologies:inputNamedGraph ontologies:omopShortcuts ;
  ontologies:outputNamedGraph ontologies:omopExpanded ;
  ontologies:precedes ontologies:post_icbo_synthea_omop_cnp_enc_participation ;
.

ontologies:miniHceCridsymShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/visit_occurrence> ;
  ontologies:predicate <http://api.stardog.com/visit_occurrence#visit_occurrence_id> ;
  ontologies:object ontologies:visit_occurrence_id_StringLiteralValue ;
.

ontologies:miniHceEnddateShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:subject <http://api.stardog.com/visit_occurrence> ;
  ontologies:predicate <http://api.stardog.com/visit_occurrence#visit_end_date> ;
  ontologies:object ontologies:visit_end_date_DateLiteralValue ;
.

ontologies:miniHceStartdateShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/visit_occurrence> ;
  ontologies:predicate <http://api.stardog.com/visit_occurrence#visit_start_date> ;
  ontologies:object ontologies:visit_start_date_DateLiteralValue ;
.

ontologies:miniHceTypeShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/visit_occurrence> ;
  ontologies:predicate <http://api.stardog.com/visit_occurrence#visit_concept_id> ;
  ontologies:object ontologies:visit_type_IntegerLiteralValue ;
  ontologies:objectRequiredToCreate ontologies:EncounterClassList ;
.

ontologies:EncounterClassList 
  ontologies:usesCustomVariableManipulationRule ontologies:encClassFromValueRule .
  
ontologies:encClassFromValueRule
  a ontologies:TurboGraphVariableManipulationLogic ;
  ontologies:usesSparql """
  BIND(IF (${dependent} = 9203, obo:OGMS_0000101, ?unbound) AS ?edEncClass) 
  BIND(IF (${dependent} = 9201, obo:OGMS_0000100, ?unbound) AS  ?inpatientEncClass) 
  BIND(IF (${dependent} = 9202, obo:OGMS_0000099, ?unbound) AS ?outpatientEncClass) 
  bind(coalesce(?edEncClass, ?inpatientEncClass, ?outpatientEncClass, obo:OGMS_0000097) as ${replacement})
  #BIND(IF (bound(?edEncClass),?edEncClass, ?unbound) as ${replacement}) 
  #BIND(IF (bound(?inpatientEncClass),?inpatientEncClass, ${replacement}) as ${replacement}) 
  #BIND(IF (bound(?outpatientEncClass),?outpatientEncClass, ${replacement}) as ${replacement}) 
  #BIND(IF (bound(${replacement}),${replacement},obo:OGMS_0000097) as ${replacement})
"""  ;
.

### encounter participation

ontologies:post_icbo_synthea_omop_cnp_enc_participation
  a ontologies:TURBO_0010178 ;
  ontologies:hasOutput ontologies:encounterRealizesRole ;
  ontologies:hasOutput ontologies:patientHasRole;
  ontologies:hasRequiredInput ontologies:encounterTypingRecipe ;
  ontologies:hasRequiredInput ontologies:miniEncounterExpansionInp ;
  ontologies:hasRequiredInput ontologies:miniEncounterPatientID ;
  ontologies:hasRequiredInput ontologies:miniPatientPkShortcut ;
  ontologies:inputNamedGraph ontologies:omopShortcuts ;
  ontologies:outputNamedGraph ontologies:omopExpanded ;
  ontologies:precedes ontologies:post_icbo_synthea_omop_cnp_procedures ;
.

ontologies:miniEncounterExpansionInp 
  a ontologies:DatatypeConnectionRecipe ;
  turbo:referencedInGraph ontologies:omopExpanded ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:required true ;
  ontologies:subject <http://api.stardog.com/visit_occurrence> ;
  ontologies:predicate ontologies:TURBO_0010113 ;
  ontologies:object ontologies:encounterToBeTyped ;
.

ontologies:miniEncounterPatientID 
  a ontologies:DatatypeConnectionRecipe ;
  turbo:referencedInGraph ontologies:omopShortcuts ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/visit_occurrence> ;
  ontologies:predicate <http://api.stardog.com/visit_occurrence#person_id> ;
  ontologies:object ontologies:person_id_StringLiteralValue ;
.

ontologies:miniPatientPkShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  turbo:referencedInGraph ontologies:omopShortcuts ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/person> ;
  ontologies:predicate <http://api.stardog.com/person#person_id> ;
  ontologies:object ontologies:person_id_StringLiteralValue ;
.


### procedures

ontologies:post_icbo_synthea_omop_cnp_procedures
  a ontologies:TURBO_0010178 ;
  ontologies:hasOutput ontologies:procedureTypingRecipe ;
  ontologies:hasOutput ontologies:procCridsymbHasRepresentation ;
  ontologies:hasOutput ontologies:cridDenotesProcedure ;
  ontologies:hasOutput ontologies:procExpansionSpecification ;
  ontologies:hasOutput ontologies:procProvDatabaseAnnotation ;
  ontologies:hasOutput ontologies:procProvSchemaAnnotation ;
  ontologies:hasOutput ontologies:procProvTableAnnotation ;
  ontologies:hasOutput ontologies:procProvColumnAnnotation ;
  ontologies:hasOutput ontologies:procProvKeyColAnnotation ;
  ontologies:hasOutput ontologies:procProvKeyValAnnotation ;
  ontologies:hasOutput ontologies:procProvValueAnnotation ;
  ontologies:hasOutput ontologies:provenanceAboutProcedure ;
  ontologies:hasOutput ontologies:symbolPartOfCrid ;
  ontologies:hasOutput ontologies:provMentionsSnomed ;
  ontologies:hasRequiredInput ontologies:procedureCridsymShortcut ;
  ontologies:hasRequiredInput ontologies:procedureSourceValueShortcut ;
  ontologies:inputNamedGraph ontologies:omopShortcuts ;
  ontologies:outputNamedGraph ontologies:omopExpanded ;
  ontologies:precedes ontologies:post_icbo_synthea_omop_cnp_procedure_participation ;
.

ontologies:procedureClassList ontologies:usesCustomVariableManipulationRule ontologies:procClassFromValueRule .

ontologies:procClassFromValueRule
  a ontologies:TurboGraphVariableManipulationLogic ;
  ontologies:usesSparql """
  BIND(IF (${dependent} = "76601001", obo:OBI_0000934, ?unbound) AS ?imInjClass) 
  BIND(IF (${dependent} = "5880005", obo:OGMS_0000057, ?unbound) AS ?physExamClass) 
  bind(coalesce(?imInjClass, ?physExamClass, obo:OGMS_0000096) as ${replacement})
"""  ;
.

# ontologies:objectRequiredToCreate

ontologies:procedureCridsymShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/procedure_occurrence> ;
  ontologies:predicate <http://api.stardog.com/procedure_occurrence#procedure_occurrence_id> ;
  ontologies:object ontologies:procedure_occurrence_id_IntegerLiteralValue ;
.

ontologies:procedureSourceValueShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/procedure_occurrence> ;
  ontologies:predicate <http://api.stardog.com/procedure_occurrence#procedure_source_value> ;
  ontologies:object ontologies:procedure_source_value_StringLiteralValue ;
  ontologies:objectRequiredToCreate ontologies:procMentionedClassList ;
  ontologies:objectRequiredToCreate ontologies:procedureClassList ;
.

ontologies:procMentionedClassFromValueRule
  a ontologies:TurboGraphVariableManipulationLogic ;
  ontologies:usesSparql """
  BIND(uri(concat('http://purl.bioontology.org/ontology/SNOMEDCT/', ${dependent} )) as  ${replacement} )
"""  ;
.

ontologies:procMentionedClassList 
  ontologies:usesCustomVariableManipulationRule ontologies:procMentionedClassFromValueRule .

### procedure participation

ontologies:post_icbo_synthea_omop_cnp_procedure_participation
  a ontologies:TURBO_0010178 ;
  ontologies:hasRequiredInput ontologies:procedureTypingRecipe ;
  ontologies:hasRequiredInput ontologies:procedurePatientShortcut ;
  ontologies:hasRequiredInput ontologies:procExpansionInput ;
  ontologies:hasRequiredInput ontologies:miniPatientPkShortcut ;
  ontologies:hasRequiredInput ontologies:patientExpansionInput ;
  ontologies:hasRequiredInput ontologies:patientHasRoleInp ;
  ontologies:hasOutput ontologies:procRealizesPatientRole ;
  ontologies:inputNamedGraph ontologies:omopShortcuts ;
  ontologies:outputNamedGraph ontologies:omopExpanded ;
  ontologies:precedes ontologies:post_icbo_synthea_omop_cnp_procedure_parthood ;
.

ontologies:post_icbo_synthea_omop_cnp_procedure_parthood
  a ontologies:TURBO_0010178 ;
  ontologies:hasRequiredInput ontologies:procedureTypingRecipe ;
  ontologies:inputNamedGraph ontologies:omopShortcuts ;
  ontologies:hasRequiredInput ontologies:miniHceCridsymShortcut ;
  ontologies:hasRequiredInput ontologies:encounterTypingRecipe ;
  ontologies:hasRequiredInput ontologies:miniEncounterExpansionInp ;
  ontologies:outputNamedGraph ontologies:omopExpanded ;
  ontologies:hasRequiredInput ontologies:procedureEncounterShortcut ;
  ontologies:hasRequiredInput ontologies:procExpansionInput ;
  ontologies:hasOutput ontologies:procPartOfEnc ;
.

ontologies:procedureEncounterShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  # ontologies:multiplicity <http://transformunify.org/ontologies/many-1> ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/procedure_occurrence> ;
  ontologies:predicate <http://api.stardog.com/procedure_occurrence#visit_occurrence_id> ;
  ontologies:object ontologies:visit_occurrence_id_StringLiteralValue ;
.


ontologies:procedurePatientShortcut 
  a ontologies:DatatypeConnectionRecipe ;
  # ontologies:multiplicity <http://transformunify.org/ontologies/many-1> ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/procedure_occurrence> ;
  ontologies:predicate <http://api.stardog.com/procedure_occurrence#person_id> ;
  ontologies:object ontologies:person_id_StringLiteralValue ;
.

ontologies:procExpansionInput
  a ontologies:ObjectConnectionToInstanceRecipe ;
  turbo:referencedInGraph ontologies:omopExpanded ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/procedure_occurrence> ;
  ontologies:predicate ontologies:TURBO_0010113 ;
  ontologies:object ontologies:procedureToBeTyped ;
.

ontologies:patientExpansionInput
  a ontologies:ObjectConnectionToInstanceRecipe ;
  turbo:referencedInGraph ontologies:omopExpanded ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject <http://api.stardog.com/person> ;
  ontologies:predicate ontologies:TURBO_0010113 ;
  ontologies:object obo:NCBITaxon_9606 ;
.

ontologies:patientHasRoleInp
  a ontologies:ObjectConnectionToInstanceRecipe ;
  turbo:referencedInGraph ontologies:omopExpanded ;
  ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  ontologies:subject obo:NCBITaxon_9606 ;
  ontologies:predicate obo:RO_0000087 ;
  ontologies:object obo:OBI_0000093 ;
.


###


# # # ontologies:GidHasOmopCode
  # # # a ontologies:DatatypeConnectionRecipe ;
  # # # turbo:referencedInGraph <https://raw.githubusercontent.com/PennTURBO/Turbo-Ontology/master/ontologies/turbo_merged.owl> ;
  # # # ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  # # # ontologies:required true ;
  # # # ontologies:subject ontologies:GidClassList ;
  # # # ontologies:predicate ontologies:TURBO_0010147 ;
  # # # ontologies:object ontologies:gender_concept_id_StringLiteralValue ;
# # # .

# # # ontologies:encClassFromValueRule
  # # # a ontologies:TurboGraphVariableManipulationLogic ;
  # # # ontologies:usesSparql """
  # # # bind(coalesce(
  # # # IF (${dependent} = 9203, obo:OGMS_0000101, ?unbound),
  # # # IF (${dependent} = 9201, obo:OGMS_0000100, ?unbound),
  # # # IF (${dependent} = 9202, obo:OGMS_0000099, ?unbound),
  # # # obo:OGMS_0000097
  # # # ) as ${replacement})
# # # """  ;
# # # .

# # # ontologies:gidClassFromValueRule
  # # # a ontologies:TurboGraphVariableManipulationLogic ;
  # # # ontologies:usesSparql """
  # # # ${replacement} ontologies:TURBO_0010147 ${dependent} .
  # # # ${dependent} rdfs:subClassOf* obo:OMRSE_00000133 .
# # # """  ;
# # # .

# # # ontologies:miniGidTypeShortcut 
  # # # a ontologies:DatatypeConnectionRecipe ;
  # # # ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  # # # ontologies:required true ;
  # # # ontologies:subject <http://api.stardog.com/person> ;
  # # # ontologies:predicate <http://api.stardog.com/person#gender_concept_id> ;
  # # # ontologies:object ontologies:gender_concept_id_StringLiteralValue ;
  # # # ontologies:objectRequiredToCreate ontologies:GidClassList ;
# # # .

# # # ontologies:post_icbo_synthea_omop_cnp_precedence
  # # # a ontologies:TURBO_0010178 ;
  # # # ontologies:hasOutput ontologies:encounterRealizesRole ;
  # # # ontologies:hasOutput ontologies:patientHasRole;
  # # # ontologies:hasRequiredInput ontologies:miniEncounterExpansionInp ;
  # # # ontologies:hasRequiredInput ontologies:encounterTypingRecipe ;
  # # # ontologies:inputNamedGraph ontologies:omopShortcuts ;
  # # # ontologies:outputNamedGraph ontologies:omopExpanded ;
  # # # ontologies:precedes ontologies:post_icbo_synthea_omop_cnp_encounters ;
# # # .

# # # ontologies:regdenFromShorts a ontologies:ObjectConnectionToClassRecipe ;
  # # # ontologies:multiplicity <http://transformunify.org/ontologies/1-1> ;
  # # # ontologies:required true ;
  # # # ontologies:subject ontologies:TURBO_0010158 ;
  # # # ontologies:predicate ontologies:assertedRegden ;
  # # # ontologies:object ontologies:allowedEncounterRegdenList ;
# # # .

# ###

# run printQuery http://transformunify.org/ontologies/post_icbo_synthea_omop_cnp_encounters
# run            http://transformunify.org/ontologies/post_icbo_synthea_omop_cnp_encounters
# run printQuery http://transformunify.org/ontologies/post_icbo_synthea_omop_cnp_patients

# run printQuery http://transformunify.org/ontologies/post_icbo_synthea_omop_cnp_enc_participation

# run printQuery http://transformunify.org/ontologies/post_icbo_synthea_omop_cnp_procedures